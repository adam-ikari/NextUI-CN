# Makefile for NextUI UI Simulator (Simplified Version)
# This version uses only the simulator code without full NextUI integration

# Platform configuration
PLATFORM = desktop

# SDL configuration
SDL_CONFIG ?= sdl2-config
SDL_CFLAGS = $(shell $(SDL_CONFIG) --cflags)
SDL_LIBS = $(shell $(SDL_CONFIG) --libs)

# Compiler settings
CC ?= gcc
CFLAGS += -Wall -Wextra -Wno-unused-parameter -O2
CFLAGS += $(SDL_CFLAGS)
CFLAGS += -DPLATFORM="$(PLATFORM)"
CFLAGS += -DSTUB_SDL_IMAGE  # Use stub for SDL2_image

# Linker flags
LDFLAGS += $(SDL_LIBS)
LDFLAGS += -lpthread -ldl -lm -lz

# Target
TARGET = nextui_simulator

# Source files - only simulator code
SOURCE = simulator.c

# Output directory
BUILD_DIR = build/desktop

# CI environment variables
export TARGET

.PHONY: all clean run test help

all: $(BUILD_DIR)/$(TARGET)
	@echo "Simulator built successfully"
	@echo "Run: make -f makefile.test run"
	@echo "Test: make -f makefile.test test"

$(BUILD_DIR)/$(TARGET): $(SOURCE)
	@mkdir -p $(BUILD_DIR)
	$(CC) $(SOURCE) -o $(BUILD_DIR)/$(TARGET) $(CFLAGS) $(LDFLAGS)
	@echo "Built: $(BUILD_DIR)/$(TARGET)"

run: $(BUILD_DIR)/$(TARGET)
	@echo "Starting NextUI Simulator..."
	./$(BUILD_DIR)/$(TARGET)

test: $(BUILD_DIR)/$(TARGET)
	@echo "Running UI screenshot tests..."
	@mkdir -p screenshots
	./$(BUILD_DIR)/$(TARGET) --auto --delay 100
	@echo "Screenshots saved to screenshots/"
	@echo "Total screenshots: $$(ls screenshots/*.bmp 2>/dev/null | wc -l)"

clean:
	rm -f $(BUILD_DIR)/$(TARGET)
	rm -rf screenshots baseline comparison_report.md
	@echo "Cleaned build artifacts and test outputs"

help:
	@echo "NextUI UI Simulator"
	@echo ""
	@echo "A desktop simulator for testing NextUI UI components without hardware."
	@echo ""
	@echo "Targets:"
	@echo "  all   Build simulator"
	@echo "  run   Build and run simulator (interactive mode)"
	@echo "  test  Build and run auto-traversal screenshot tests"
	@echo "  clean Clean build artifacts and test outputs"
	@echo "  help  Show this help message"
	@echo ""
	@echo "Usage:"
	@echo "  make -f makefile.test [target]"
	@echo ""
	@echo "Test Output:"
	@echo "  Screenshots are saved to screenshots/ directory"
	@echo "  Baseline images are stored in baseline/ directory"
	@echo "  Comparison report is saved to comparison_report.md"