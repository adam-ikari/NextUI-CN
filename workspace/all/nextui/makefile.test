# Test Makefile for NextUI

# Platform configuration
ifeq (,$(PLATFORM))
PLATFORM=$(UNION_PLATFORM)
endif

# SDL configuration
SDL_CONFIG ?= sdl2-config
SDL_CFLAGS = $(shell $(SDL_CONFIG) --cflags)
SDL_LIBS = $(shell $(SDL_CONFIG) --libs)

# SDL_image configuration
SDL_IMAGE_CFLAGS = $(shell pkg-config --cflags SDL2_image 2>/dev/null)
SDL_IMAGE_LIBS = $(shell pkg-config --libs SDL2_image 2>/dev/null)

# Fallback if pkg-config fails
ifeq ($(SDL_IMAGE_CFLAGS),)
SDL_IMAGE_CFLAGS = -I/usr/include/SDL2
SDL_IMAGE_LIBS = -lSDL2_image
endif

# Compiler settings
CC ?= gcc
CFLAGS += -Wall -Wextra -O2 $(SDL_CFLAGS) $(SDL_IMAGE_CFLAGS)
LDFLAGS += $(SDL_LIBS) $(SDL_IMAGE_LIBS)

# Source files
TEST_SOURCES = test_nextui.c
TEST_TARGET = test_nextui

# Output directory
TEST_OUTPUT_DIR = test_output

.PHONY: all clean test create-baseline run

all: $(TEST_TARGET)

$(TEST_TARGET): $(TEST_SOURCES)
	$(CC) $(CFLAGS) $(TEST_SOURCES) -o $(TEST_TARGET) $(LDFLAGS)
	@echo "Test binary built: $(TEST_TARGET)"

test: $(TEST_TARGET)
	@mkdir -p $(TEST_OUTPUT_DIR)
	@echo "Running tests..."
	./$(TEST_TARGET)

create-baseline: $(TEST_TARGET)
	@mkdir -p $(TEST_OUTPUT_DIR)
	@echo "Creating baseline images..."
	./$(TEST_TARGET) --create-baseline

clean:
	rm -f $(TEST_TARGET)
	rm -rf $(TEST_OUTPUT_DIR)

help:
	@echo "NextUI Test Suite"
	@echo ""
	@echo "Targets:"
	@echo "  all            Build test binary"
	@echo "  test           Run regression tests"
	@echo "  create-baseline Create baseline images"
	@echo "  clean          Clean build artifacts"
	@echo "  help           Show this help message"
	@echo ""
	@echo "Usage:"
	@echo "  make -f makefile.test [target]"
